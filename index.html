<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üåç Anouk's World Challenge 2026</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      position: relative;
      overflow-x: hidden;
    }
    .floating-hearts {
      position: fixed; width: 100%; height: 100%;
      overflow: hidden; pointer-events: none; z-index: 1;
    }
    .heart {
      position: absolute;
      font-size: 20px;
      animation: float-up 8s linear infinite;
      opacity: 0.35;
    }
    @keyframes float-up {
      0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 0.35; }
      90% { opacity: 0.35; }
      100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
    }
    .app-container {
      max-width: 500px; margin: 0 auto; min-height: 100vh;
      background: #fff; position: relative; z-index: 10;
      box-shadow: 0 0 50px rgba(0,0,0,0.2);
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px 20px; text-align: center; color: #fff;
      position: relative; overflow: hidden;
    }
    .header::before {
      content: ""; position: absolute; top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 3s linear infinite;
    }
    @keyframes shimmer { 0% { transform: rotate(0deg);} 100%{ transform: rotate(360deg);} }
    .header h1 { font-size: 28px; margin-bottom: 10px; position: relative; z-index: 1;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    .header p { opacity: 0.95; font-size: 14px; position: relative; z-index: 1; }
    .stats-bar {
      background: #fff; padding: 15px; display: flex; justify-content: space-around;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100;
    }
    .stat { text-align: center; cursor: pointer; transition: transform 0.2s; }
    .stat:hover { transform: scale(1.08); }
    .stat-value {
      font-size: 24px; font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .stat-label { font-size: 11px; color: #666; margin-top: 2px; }
    .progress-bar { height: 6px; background: #f0f0f0; position: relative; overflow: hidden; }
    .progress-fill {
      height: 100%; background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%; transition: width 0.5s ease; position: relative;
    }
    .progress-fill::after {
      content: ""; position: absolute; top:0; left:0; right:0; bottom:0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: shine 2s infinite;
    }
    @keyframes shine { 0%{ transform: translateX(-100%);} 100%{ transform: translateX(100%);} }
    .tabs {
      display: flex; background: #f8f9fa; border-bottom: 1px solid #e0e0e0;
      position: sticky; top: 73px; z-index: 99;
    }
    .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer;
      transition: all 0.3s; font-size: 14px; position: relative; }
    .tab:hover { background: #f0f0f0; }
    .tab.active { background: #fff; color: #667eea; font-weight: 600; }
    .tab.active::after {
      content: ""; position: absolute; bottom: 0; left: 0; right: 0; height: 3px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }
    .tab-icon { font-size: 20px; margin-bottom: 5px; }
    .content { padding: 20px; min-height: 400px; }
    .country-section { margin-bottom: 30px; opacity: 0; animation: fadeIn 0.5s forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    .country-header {
      display: flex; align-items: center; margin-bottom: 15px; padding: 15px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 12px; cursor: pointer; transition: transform 0.3s;
    }
    .country-header:hover { transform: translateX(5px); }
    .country-flag { font-size: 32px; margin-right: 15px; }
    .country-info h3 { color: #333; margin-bottom: 3px; }
    .country-info span { font-size: 12px; color: #666; }
    .country-progress { margin-left: auto; text-align: center; }
    .progress-circle {
      --progress: 0deg;
      width: 50px; height: 50px; border-radius: 50%;
      background: conic-gradient(#667eea 0deg, #667eea var(--progress), #f0f0f0 var(--progress));
      display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; position: relative;
    }
    .progress-circle::before {
      content: ""; position: absolute; width: 40px; height: 40px; background: #fff; border-radius: 50%; z-index: 0;
    }
    .progress-circle span { position: relative; z-index: 1; }
    .challenge-card {
      background: #fff; border: 1px solid #e0e0e0; border-radius: 12px; padding: 15px;
      margin-bottom: 12px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;
    }
    .challenge-card::before {
      content: ""; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(102,126,234,0.1), transparent);
      transition: left 0.5s;
    }
    .challenge-card:hover::before { left: 100%; }
    .challenge-card:hover { transform: translateY(-3px); box-shadow: 0 5px 20px rgba(102,126,234,0.3); }
    .challenge-card.completed { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); opacity: 0.85; }
    .challenge-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    .challenge-category {
      display: inline-block; padding: 4px 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff; border-radius: 12px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
    }
    .challenge-points { font-weight: bold; color: #667eea; font-size: 14px; }
    .challenge-title { font-weight: 600; color: #333; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
    .challenge-description { font-size: 13px; color: #666; line-height: 1.4; }
    .challenge-reward { margin-top: 10px; padding: 8px;
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 5px;
    }
    .mystery-box {
      background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
      color: #fff; padding: 20px; border-radius: 15px; margin: 20px 0; text-align: center; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;
    }
    .mystery-box::before {
      content: "üéÅ"; position: absolute; font-size: 100px; opacity: 0.1;
      top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%,100% { transform: translate(-50%, -50%) rotate(-15deg) scale(1); }
      50% { transform: translate(-50%, -50%) rotate(-15deg) scale(1.08); }
    }
    .mystery-box:hover { transform: scale(1.02); box-shadow: 0 10px 30px rgba(108,92,231,0.4); }
    .mystery-box h4 { font-size: 18px; margin-bottom: 5px; position: relative; }
    .mystery-box p { font-size: 13px; opacity: 0.95; position: relative; }
    .leaderboard {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 15px; padding: 20px; margin: 20px 0;
    }
    .leaderboard-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px; background: #fff; border-radius: 10px; margin-bottom: 10px;
      transition: transform 0.3s;
    }
    .leaderboard-item:hover { transform: translateX(5px); }
    .achievement-grid {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 15px; margin: 20px 0;
    }
    .achievement-badge {
      text-align: center; padding: 15px 10px; background: #fff; border: 2px solid #e0e0e0;
      border-radius: 12px; transition: all 0.3s; cursor: pointer; position: relative;
    }
    .achievement-badge.unlocked { border-color: #667eea; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); animation: unlock 0.5s ease; }
    @keyframes unlock {
      0% { transform: scale(0.8) rotate(-10deg); }
      50% { transform: scale(1.1) rotate(5deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    .achievement-badge.unlocked::after {
      content: "‚úì"; position: absolute; top: 5px; right: 5px; background: #667eea; color: #fff;
      width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;
    }
    .achievement-icon { font-size: 32px; margin-bottom: 8px; }
    .achievement-badge.locked .achievement-icon { filter: grayscale(1); opacity: 0.35; }
    .achievement-name { font-size: 11px; font-weight: 600; color: #333; }
    .achievement-badge.locked .achievement-name { color: #999; }
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); z-index: 1000; animation: fadeIn 0.3s;
    }
    .modal.active { display: flex; align-items: center; justify-content: center; }
    .modal-content {
      background: #fff; border-radius: 20px; padding: 30px; max-width: 420px; width: 90%; text-align: center; animation: slideUp 0.3s; position: relative;
    }
    @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .modal-close { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: #999; transition: color 0.3s; }
    .modal-close:hover { color: #333; }
    .complete-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 600;
      cursor: pointer; transition: all 0.3s; margin-top: 20px; position: relative; overflow: hidden;
    }
    .complete-button::before {
      content: ""; position: absolute; top: 50%; left: 50%; width: 0; height: 0; background: rgba(255,255,255,0.3);
      border-radius: 50%; transform: translate(-50%,-50%); transition: width 0.6s, height 0.6s;
    }
    .complete-button:hover::before { width: 300px; height: 300px; }
    .complete-button:hover { transform: scale(1.04); box-shadow: 0 10px 30px rgba(102,126,234,0.4); }
    .reward-notification {
      position: fixed; top: 20px; right: 20px; background: #fff; padding: 15px 20px; border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2); transform: translateX(400px); transition: transform 0.3s; z-index: 2000; max-width: 300px;
    }
    .reward-notification.show { transform: translateX(0); }
    .reward-notification h4 { color: #667eea; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
    .special-date-banner {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
      color: #fff; padding: 15px; text-align: center; border-radius: 12px; margin: 20px;
      animation: glow 2s ease-in-out infinite;
    }
    @keyframes glow { 0%,100% { box-shadow: 0 0 20px rgba(255,107,107,0.5);} 50%{ box-shadow: 0 0 30px rgba(255,107,107,0.8);} }
    .filter-buttons { display: flex; gap: 8px; margin: 15px 0; flex-wrap: wrap; }
    .filter-btn {
      padding: 6px 12px; border: 1px solid #e0e0e0; background: #fff; border-radius: 20px; font-size: 12px; cursor: pointer; transition: all 0.3s;
    }
    .filter-btn:hover { border-color: #667eea; color: #667eea; }
    .filter-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border-color: transparent; }
    .countdown { text-align: center; padding: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 15px; margin: 20px; }
    .countdown-timer { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
    .countdown-item { text-align: center; }
    .countdown-value { font-size: 28px; font-weight: bold; color: #667eea; }
    .countdown-label { font-size: 11px; color: #666; text-transform: uppercase; }
    @media (max-width: 500px) { .app-container { max-width: 100%; } }
  </style>
</head>
<body>
  <div class="floating-hearts" id="hearts"></div>
  <div class="app-container">
    <div class="header">
      <h1>üåç Anouk's Wereldreis Challenge 2025</h1>
      <p>Voor nog meer onvergetelijke momentenüíã</p>
    </div>

    <div class="stats-bar">
      <div class="stat" onclick="showTab('countries')">
        <div class="stat-value" id="totalPoints">0</div>
        <div class="stat-label">Punten</div>
      </div>
      <div class="stat" onclick="showTab('achievements')">
        <div class="stat-value" id="completedChallenges">0/0</div>
        <div class="stat-label">Challenges</div>
      </div>
      <div class="stat" onclick="showTab('rewards')">
        <div class="stat-value" id="unlockedRewards">0</div>
        <div class="stat-label">Beloningen</div>
      </div>
    </div>

    <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>

    <div class="tabs">
      <div class="tab active" data-tab="countries" onclick="showTab('countries')">
        <div class="tab-icon">üó∫Ô∏è</div><div>Landen</div>
      </div>
      <div class="tab" data-tab="achievements" onclick="showTab('achievements')">
        <div class="tab-icon">üèÜ</div><div>Badges</div>
      </div>
      <div class="tab" data-tab="rewards" onclick="showTab('rewards')">
        <div class="tab-icon">üéÅ</div><div>Beloningen</div>
      </div>
    </div>

    <div id="specialBannerContainer"></div>
    <div id="countdownContainer"></div>

    <div class="content" id="content"></div>
  </div>

  <div class="modal" id="challengeModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <h3 id="modalTitle"></h3>
      <p id="modalDescription" style="margin-top:8px;"></p>
      <p id="modalLocation" style="margin-top:8px; font-size:13px; opacity:0.9;"></p>
      <div id="modalRewardBox" class="challenge-reward" style="display:none; margin-top:14px;"></div>
      <button id="completeBtn" class="complete-button" onclick="completeChallenge()">‚úì Challenge Voltooid!</button>
      <button id="undoBtn" class="complete-button" style="display:none; margin-left:10px; background:linear-gradient(135deg,#999,#777)" onclick="undoChallenge()">‚Ü© Ongedaan maken</button>
    </div>
  </div>

  <div class="reward-notification" id="rewardNotification">
    <h4>üéâ Nieuwe Beloning!</h4>
    <p id="rewardText"></p>
  </div>

  <script>
    /* ------------------------
       Config & Data
       ------------------------ */

    // ‚öôÔ∏è Pas hier eenvoudig je startdatum aan (YYYY-MM-DD)
    const tripStartDate = localStorage.getItem('wr_tripStart') || '2025-12-30';

    // Dataset per land (compact maar uitbreidbaar)
    const data = {
      newZealand: {
        id: 'newZealand',
        name: 'Nieuw-Zeeland',
        flag: 'üá≥üáø',
        period: 'Januari ‚Äì Februari',
        challenges: [
          { id: 'nz1', category: 'culinair', title: 'Martinborough Wijn Meester', description: 'Proef 5 Pinot Noirs en kies je favoriet.', points: 50, reward: 'üç∑ Fles lokale wijn', location: 'Martinborough' },
          { id: 'nz2', category: 'hiking', title: 'Abel Tasman Zonsopgang', description: 'Start v√≥√≥r zonsopgang en maak een foto op Anchorage Bay.', points: 75, reward: 'ü•æ Hiking sokken', location: 'Abel Tasman' },
          { id: 'nz3', category: 'kite', title: 'Kaik≈çura Kite Queen', description: 'Ga kiten met dolfijnen op de achtergrond (op veilige afstand).', points: 100, reward: 'ü™Å Kite-sticker', location: 'Kaik≈çura' },
          { id: 'nz4', category: 'sociaal', title: 'Kea Whisperer', description: 'Spot een kea in het wild en imiteer zijn roep.', points: 60, reward: 'ü¶ú Mini kea knuffel', location: 'Arthur‚Äôs Pass' },
          { id: 'nz5', category: 'culinair', title: 'Fergburger Challenge', description: 'Eet een vega Fergburger zonder bestek.', points: 40, reward: 'üçî Fancy dinner bon', location: 'Queenstown' },
          { id: 'nz6', category: 'wildcard', title: 'Milford Sound Magie', description: 'Zwem 30 seconden in Milford Sound!', points: 150, reward: 'üèä Spa behandeling', location: 'Milford Sound' },
          { id: 'nz7', category: 'hiking', title: 'Mount Cook Stargazer', description: 'Kampeer en tel 10 vallende sterren.', points: 80, reward: '‚≠ê Sterrenkaart', location: 'Aoraki/Mt Cook' },
          { id: 'nz8', category: 'sociaal', title: 'Street Art Scout', description: 'Vind 10 street-art werken in Christchurch en maak een collage.', points: 45, reward: 'üé® Lokaal kunstwerk', location: 'Christchurch' },
          { id: 'nz9', category: 'culinair', title: 'Vissersvrouw', description: 'Eet fish & chips op de veerboot bij zonsondergang.', points: 35, reward: 'üêü Viskookboek', location: 'Auckland' },
          { id: 'nz10', category: 'romance', title: 'Franz Josef Glacier Kiss', description: 'Geef een kus bij het Glacier viewpoint.', points: 50, reward: 'üíã Romantisch verrassingpakket', location: 'Franz Josef' },
          { id: 'nz11', category: 'hiking', title: 'Te Anau Glowworm', description: 'Bezoek de glowworm grotten; 10s volledige stilte.', points: 55, reward: '‚ú® Glow-in-the-dark sterren', location: 'Te Anau' },
          { id: 'nz12', category: 'kite', title: 'Wellington Wind Warrior', description: 'Kite in de Wellington-wind (bonus: overeind blijven).', points: 90, reward: 'üí® Windvaste reisjas', location: 'Wellington' },
          { id: 'nz13', category: 'sociaal', title: 'Bark Bay Seal Selfie', description: 'Selfie met een zeehond (op veilige afstand!).', points: 70, reward: 'üì∏ Waterdichte hoes', location: 'Bark Bay' },
          { id: 'nz14', category: 'culinair', title: 'Akaroa Franse Connectie', description: 'Bestel je hele lunch in het Frans.', points: 60, reward: 'ü•ê Delicatessen pakket', location: 'Akaroa' },
          { id: 'nz15', category: 'hiking', title: 'Hooker Valley Touch', description: 'Voltooi de Hooker Valley Track en raak de gletsjer aan.', points: 85, reward: 'üèîÔ∏è Wandelstok', location: 'Aoraki/Mt Cook' },
          { id: 'nz16', category: 'culinair', title: 'Pannenkoekenrots Picknick', description: 'Eet zelfgemaakte pannenkoeken bij Pancake Rocks.', points: 65, reward: 'ü•û Pannenkoeken-set', location: 'Punakaiki' },
          { id: 'nz17', category: 'sociaal', title: 'Cape Foulwind Pup Teller', description: 'Tel de baby zeehonden bij de kolonie.', points: 45, reward: 'ü¶≠ Cute pin', location: 'Cape Foulwind' }
        ]
      },
      vietnam: {
        id: 'vietnam',
        name: 'Vietnam',
        flag: 'üáªüá≥',
        period: 'Februari ‚Äì Maart',
        challenges: [
          { id: 'vn1', category: 'culinair', title: 'Nachtmarkt A-Z', description: 'Eet 26 hapjes van A tot Z (vis is ok√©).', points: 80, reward: 'üçú Food tour naar keuze', location: 'Hoi An / Hanoi' },
          { id: 'vn2', category: 'sociaal', title: 'T·∫øt-buddy', description: 'Vier T·∫øt met locals en leer 3 wensen in het Vietnamees.', points: 60, reward: 'üßß Geluksamuletten', location: 'Overal' },
          { id: 'vn3', category: 'hiking', title: 'Sapa Ridge Walk', description: 'Zonsopgang hike met rijstterrassen uitzicht.', points: 70, reward: 'ü•æ Gaiters', location: 'Sapa' },
          { id: 'vn4', category: 'wildcard', title: 'Verborgen Waterval', description: 'Vind een geheime waterval en deel GPS-co√∂rdinaten.', points: 90, reward: 'üí¶ Drybag', location: 'Noord-VN' },
          { id: 'vn5', category: 'culinair', title: '8-Poot Challenge', description: 'Probeer iets met >8 pootjes op een nachtmarkt üòâ', points: 100, reward: 'üç∫ Verfrissingspakket', location: 'Saigon/Hanoi' }
        ]
      },
      china: {
        id: 'china', name: 'China', flag: 'üá®üá≥', period: 'Maart ‚Äì April',
        challenges: [
          { id: 'cn1', category: 'culinair', title: 'Sichuan Vuurdoop', description: 'Overleef hotpot level 5 üî•', points: 100, reward: 'ü•µ Milk tea traktatie', location: 'Chengdu' },
          { id: 'cn2', category: 'sociaal', title: 'Mahjong Master', description: 'Win een potje van Chinese oma‚Äôs.', points: 90, reward: 'üÄÑ Mini setje', location: 'Chengdu / Shanghai' },
          { id: 'cn3', category: 'hiking', title: 'Tiger Leaping Gorge', description: 'Trek de kloof en vind een ‚Äúsecret view‚Äù.', points: 120, reward: '‚õ∞Ô∏è Buff', location: 'Yunnan' },
          { id: 'cn4', category: 'wildcard', title: 'Theeceremonie', description: 'Volg een theeceremonie en noteer 3 theesoorten.', points: 60, reward: 'üçµ Theesetje', location: 'Hangzhou' }
        ]
      },
      taiwan: {
        id: 'taiwan', name: 'Taiwan', flag: 'üáπüáº', period: 'April',
        challenges: [
          { id: 'tw1', category: 'culinair', title: 'Nachtmarkt Ninja', description: 'Scoor 7 iconische snacks op 1 avond.', points: 70, reward: 'üßã Bubble-tea bon', location: 'Taipei' },
          { id: 'tw2', category: 'hiking', title: 'Alishan Sunrise', description: 'Zonsopgang tussen de wolkenzee.', points: 80, reward: 'üåÑ Thermos', location: 'Alishan' },
          { id: 'tw3', category: 'wildcard', title: 'Firefly Magic', description: 'Spot vuurvliegjes in de bergen.', points: 60, reward: '‚ú® Mini lantaarn', location: 'Nantou' }
        ]
      },
      spain: {
        id: 'spain', name: 'Spanje', flag: 'üá™üá∏', period: 'Mei ‚Äì Juli',
        challenges: [
          { id: 'es1', category: 'kite', title: 'Tarifa Sunset Kite', description: 'Kite met zonsondergang aan de Straat van Gibraltar.', points: 85, reward: 'üï∂Ô∏è Zonnebril koord', location: 'Tarifa' },
          { id: 'es2', category: 'sociaal', title: 'San Ferm√≠n Toeschouwer', description: 'Beleef het festival als toeschouwer en interview 2 locals.', points: 70, reward: 'üéüÔ∏è Event treat', location: 'Pamplona' }
        ]
      },
      portugal: {
        id: 'portugal', name: 'Portugal', flag: 'üáµüáπ', period: 'Mei ‚Äì Juli',
        challenges: [
          { id: 'pt1', category: 'culinair', title: 'Kaasboer Vriend', description: 'Maak vrienden met een kaasboer op de markt en leer 2 kazen.', points: 65, reward: 'üßÄ Proefplankje', location: 'Diverse' },
          { id: 'pt2', category: 'culinair', title: 'Sardine Festival', description: 'Vier het sardine-festival en scoor het beste broodje.', points: 60, reward: 'üêü Sardinha pin', location: 'Lissabon/Set√∫bal' }
        ]
      },
      nepal: {
        id: 'nepal', name: 'Nepal', flag: 'üá≥üáµ', period: 'Oktober',
        challenges: [
          { id: 'np1', category: 'hiking', title: 'Poon Hill Sunrise', description: 'Zonsopgang met Himalaya panorama.', points: 110, reward: 'üß¢ Cap / buff', location: 'Ghorepani' },
          { id: 'np2', category: 'sociaal', title: 'Dashain Vibes', description: 'Maak een foto met tika & deel blessings.', points: 70, reward: 'üéâ Festival souvenir', location: 'Kathmandu / Pokhara' },
          { id: 'np3', category: 'wildcard', title: 'Bruiloft-crasher üòâ', description: 'Dans 1 nummer mee op een Nepalese bruiloft.', points: 120, reward: 'üíÉ Date-night', location: 'Overal' }
        ]
      }
    };

    // Achievements definities (afgeleid op basis van voortgang)
    const achievements = [
      { id: 'a1', icon: 'üíã', name: 'First Kiss', test: (state) => state.completedIds.some(id => /kiss/i.test(id) || /romance/.test(getChallengeById(id)?.category || '')) },
      { id: 'a2', icon: 'üç∑', name: 'Wine Warrior', test: (state) => countByCategory(state, 'culinair') >= 5 },
      { id: 'a3', icon: '‚õ∞Ô∏è', name: 'Hiking Hero', test: (state) => countByCategory(state, 'hiking') >= 5 },
      { id: 'a4', icon: 'ü™Å', name: 'Kite Queen', test: (state) => uniqueCountriesForCategory(state, 'kite') >= 3 },
      { id: 'a5', icon: 'üó£Ô∏è', name: 'Social Butterfly', test: (state) => countByCategory(state, 'sociaal') >= 5 },
      { id: 'a6', icon: 'üé≤', name: 'Wildcard Waanzin', test: (state) => countByCategory(state, 'wildcard') >= 3 },
    ];

    // Beloning thresholds (bij X gehaalde challenges)
    const rewardMilestones = [
      { threshold: 10, text: 'Backpacking escape - een nacht in een luxe accomodatie naar keuze üßÅ' },
      { threshold: 25, text: 'Fancy pancy dinner naar keuze üçΩÔ∏è' },
      { threshold: 50, text: 'Je bent goud waardüéÅ' }
    ];

    /* ------------------------
       State & Storage
       ------------------------ */
    const STORAGE_KEY = 'wr_state_v1';
    function defaultState() {
      return {
        completed: {},            // { challengeId: true }
        rewardsUnlocked: [],      // milestone thresholds reached
        achievementsUnlocked: [], // achievement ids
      };
    }
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaultState();
        const parsed = JSON.parse(raw);
        return Object.assign(defaultState(), parsed);
      } catch(e) {
        console.warn('State load failed', e);
        return defaultState();
      }
    }
    function saveState() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    let state = loadState();
    let currentModalChallengeId = null;

    /* ------------------------
       Helpers
       ------------------------ */
    function allChallenges() {
      return Object.values(data).flatMap(country => country.challenges.map(ch => ({...ch, countryId: country.id})));
    }
    function getChallengeById(id) {
      return allChallenges().find(c => c.id === id);
    }
    function getCountryByChallengeId(id) {
      const ch = getChallengeById(id);
      return ch ? data[ch.countryId] : null;
    }
    function counts() {
      const list = allChallenges();
      const total = list.length;
      const completedIds = Object.keys(state.completed).filter(k => state.completed[k]);
      const completed = completedIds.length;
      const points = completedIds.reduce((sum, id) => {
        const ch = getChallengeById(id); return sum + (ch ? ch.points : 0);
      }, 0);
      return { total, completed, points, completedIds };
    }
    function countByCategory(_state, category) {
      return _state.completedIds
        .map(id => getChallengeById(id))
        .filter(ch => ch && ch.category === category).length;
    }
    function uniqueCountriesForCategory(_state, category) {
      const s = new Set();
      _state.completedIds.forEach(id => {
        const ch = getChallengeById(id);
        if (ch && ch.category === category) {
          const c = getCountryByChallengeId(id);
          if (c) s.add(c.id);
        }
      });
      return s.size;
    }
    function showNotification(text) {
      const n = document.getElementById('rewardNotification');
      const t = document.getElementById('rewardText');
      t.textContent = text;
      n.classList.add('show');
      setTimeout(() => n.classList.remove('show'), 3000);
    }
    function formatPct(n) { return Math.round(n*100); }
    function degFromPct(p) { return Math.round(p * 360) + 'deg'; }

    /* ------------------------
       Rendering
       ------------------------ */
    function setActiveTab(tab) {
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      const active = document.querySelector(`.tab[data-tab="${tab}"]`);
      if (active) active.classList.add('active');
    }

    function showTab(tab) {
      setActiveTab(tab);
      const content = document.getElementById('content');
      if (tab === 'countries') renderCountries(content);
      if (tab === 'achievements') renderAchievements(content);
      if (tab === 'rewards') renderRewards(content);
    }

    function renderCountries(container) {
      const { total, completed, points } = counts();
      updateStats();

      let html = `
        <div class="filter-buttons">
          ${['alles','culinair','hiking','kite','sociaal','wildcard','romance'].map(cat => `
            <button class="filter-btn" data-filter="${cat}">${cat[0].toUpperCase()+cat.slice(1)}</button>
          `).join('')}
        </div>
      `;

      Object.values(data).forEach(country => {
        const totalC = country.challenges.length;
        const doneC = country.challenges.filter(ch => state.completed[ch.id]).length;
        const pct = totalC ? (doneC / totalC) : 0;
        html += `
          <section class="country-section" id="sec-${country.id}">
            <div class="country-header" onclick="toggleCountry('${country.id}')">
              <div class="country-flag">${country.flag}</div>
              <div class="country-info">
                <h3>${country.name}</h3>
                <span>${country.period} ‚Ä¢ ${doneC}/${totalC} voltooid</span>
              </div>
              <div class="country-progress">
                <div class="progress-circle" id="pc-${country.id}" style="--progress:${degFromPct(pct)}">
                  <span>${formatPct(pct)}%</span>
                </div>
              </div>
            </div>
            <div class="country-body" id="body-${country.id}">
              ${country.challenges.map(ch => renderChallengeCard(ch)).join('')}
            </div>
          </section>
        `;
      });

      container.innerHTML = html;

      // filter logic
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const filter = btn.dataset.filter;
          filterChallenges(filter);
        });
      });
    }

    function renderChallengeCard(ch) {
      const done = !!state.completed[ch.id];
      const rewardLocked = !done;
      return `
        <div class="challenge-card ${done ? 'completed' : ''}" data-challenge="${ch.id}" onclick="openModal('${ch.id}')">
          <div class="challenge-header">
            <span class="challenge-category">${ch.category}</span>
            <span class="challenge-points">+${ch.points}p</span>
          </div>
          <div class="challenge-title">${ch.title}</div>
          <div class="challenge-description">${ch.description}</div>
          <div class="challenge-reward">
            ${rewardLocked ? 'üîí Beloning verborgen' : 'üéÅ ' + ch.reward}
          </div>
        </div>
      `;
    }

    function toggleCountry(countryId) {
      const body = document.getElementById('body-' + countryId);
      if (!body) return;
      body.style.display = (body.style.display === 'none') ? '' : 'none';
    }

    function filterChallenges(filter) {
      const cards = document.querySelectorAll('.challenge-card');
      if (filter === 'alles') {
        cards.forEach(c => c.style.display = '');
        return;
      }
      cards.forEach(c => {
        const id = c.getAttribute('data-challenge');
        const ch = getChallengeById(id);
        c.style.display = (ch && ch.category === filter) ? '' : 'none';
      });
    }

    function renderAchievements(container) {
      updateStats();
      const _counts = counts();
      const st = Object.assign({}, state, { completedIds: _counts.completedIds });

      // recalc unlocked
      const newlyUnlocked = [];
      achievements.forEach(a => {
        const ok = !!a.test(st);
        const already = state.achievementsUnlocked.includes(a.id);
        if (ok && !already) {
          state.achievementsUnlocked.push(a.id);
          newlyUnlocked.push(a.name);
        }
      });
      if (newlyUnlocked.length) {
        saveState();
        showNotification('Nieuwe badge(s): ' + newlyUnlocked.join(', '));
      }

      const html = `
        <div class="leaderboard">
          <div class="leaderboard-item"><strong>Jullie</strong><span>${_counts.points} punten ‚Ä¢ ${_counts.completed}/${_counts.total} challenges</span></div>
        </div>
        <div class="achievement-grid">
          ${achievements.map(a => {
            const unlocked = state.achievementsUnlocked.includes(a.id);
            return `
              <div class="achievement-badge ${unlocked ? 'unlocked' : 'locked'}">
                <div class="achievement-icon">${a.icon}</div>
                <div class="achievement-name">${a.name}</div>
              </div>
            `;
          }).join('')}
        </div>
      `;
      container.innerHTML = html;
    }

    function renderRewards(container) {
      updateStats();
      const { completed } = counts();

      // Milestones (mystery boxes)
      const boxes = rewardMilestones.map(m => {
        const unlocked = completed >= m.threshold;
        const status = unlocked ? 'Ontgrendeld' : `Vergrendel tot ${m.threshold} challenges`;
        return `
          <div class="mystery-box" onclick="openMilestone(${m.threshold})" style="opacity:${unlocked?1:0.6}">
            <h4>üéÅ Mystery Box @ ${m.threshold} challenges</h4>
            <p>${unlocked ? 'Klik om te openen!' : status}</p>
          </div>
        `;
      }).join('');

      const html = `
        ${boxes}
        <div class="leaderboard">
          <div style="margin-bottom:8px; font-weight:600;">Ontgrendelde beloningen</div>
          ${(state.rewardsUnlocked.length === 0)
            ? '<div class="leaderboard-item">Nog geen beloningen ontgrendeld‚Ä¶ üöÄ</div>'
            : state.rewardsUnlocked.map(t => `<div class="leaderboard-item">${t}</div>`).join('')
          }
        </div>
      `;
      container.innerHTML = html;
    }

    function updateStats() {
      const { total, completed, points } = counts();
      document.getElementById('totalPoints').textContent = points;
      document.getElementById('completedChallenges').textContent = `${completed}/${total}`;
      const pct = total ? (completed/total)*100 : 0;
      document.getElementById('progressBar').style.width = pct + '%';
      document.getElementById('unlockedRewards').textContent = state.rewardsUnlocked.length;

      // Update country progress circles if present
      Object.values(data).forEach(country => {
        const totalC = country.challenges.length;
        const doneC = country.challenges.filter(ch => state.completed[ch.id]).length;
        const p = totalC ? (doneC/totalC) : 0;
        const el = document.getElementById('pc-'+country.id);
        if (el) {
          el.style.setProperty('--progress', degFromPct(p));
          const span = el.querySelector('span');
          if (span) span.textContent = formatPct(p) + '%';
        }
      });
    }

    /* ------------------------
       Modal & Actions
       ------------------------ */
    function openModal(chId) {
      currentModalChallengeId = chId;
      const ch = getChallengeById(chId);
      if (!ch) return;
      document.getElementById('modalTitle').textContent = ch.title;
      document.getElementById('modalDescription').textContent = ch.description;
      document.getElementById('modalLocation').textContent = ch.location ? ('üìç ' + ch.location) : '';
      const rewardBox = document.getElementById('modalRewardBox');
      const done = !!state.completed[ch.id];
      rewardBox.style.display = done ? 'block' : 'none';
      rewardBox.textContent = 'üéÅ ' + ch.reward;

      document.getElementById('completeBtn').style.display = done ? 'none' : 'inline-block';
      document.getElementById('undoBtn').style.display = done ? 'inline-block' : 'none';

      document.getElementById('challengeModal').classList.add('active');
    }
    function closeModal() {
      currentModalChallengeId = null;
      document.getElementById('challengeModal').classList.remove('active');
    }
    function completeChallenge() {
      if (!currentModalChallengeId) return;
      state.completed[currentModalChallengeId] = true;
      saveState();
      closeModal();
      // Rewards per milestone
      checkMilestones();
      // Re-render current tab
      const active = document.querySelector('.tab.active')?.getAttribute('data-tab') || 'countries';
      showTab(active);
    }
    function undoChallenge() {
      if (!currentModalChallengeId) return;
      delete state.completed[currentModalChallengeId];
      saveState();
      closeModal();
      const active = document.querySelector('.tab.active')?.getAttribute('data-tab') || 'countries';
      showTab(active);
    }
    function checkMilestones() {
      const { completed } = counts();
      rewardMilestones.forEach(m => {
        if (completed >= m.threshold && !state.rewardsUnlocked.includes(m.text)) {
          state.rewardsUnlocked.push(m.text);
          saveState();
          showNotification(m.text);
        }
      });
    }
    function openMilestone(threshold) {
      const m = rewardMilestones.find(x => x.threshold === threshold);
      if (!m) return;
      const { completed } = counts();
      if (completed < threshold) {
        showNotification(`Nog ${threshold - completed} challenges tot deze box opent!`);
        return;
      }
      showNotification(`Geopend: ${m.text}`);
    }

    /* ------------------------
       Countdown & Special Banner
       ------------------------ */
    function renderCountdown() {
      const wrap = document.getElementById('countdownContainer');
      const html = `
        <div class="countdown">
          <div><strong>‚è≥ Countdown tot vertrek (${tripStartDate})</strong></div>
          <div class="countdown-timer">
            <div class="countdown-item"><div class="countdown-value" id="cd-days">0</div><div class="countdown-label">dagen</div></div>
            <div class="countdown-item"><div class="countdown-value" id="cd-hours">0</div><div class="countdown-label">uren</div></div>
            <div class="countdown-item"><div class="countdown-value" id="cd-mins">0</div><div class="countdown-label">min</div></div>
            <div class="countdown-item"><div class="countdown-value" id="cd-secs">0</div><div class="countdown-label">sec</div></div>
          </div>
        </div>
      `;
      wrap.innerHTML = html;
      updateCountdown();
      setInterval(updateCountdown, 1000);
    }
    function updateCountdown() {
      const tgt = new Date(tripStartDate + 'T00:00:00');
      const now = new Date();
      let diff = Math.max(0, tgt - now);
      const d = Math.floor(diff / (1000*60*60*24)); diff -= d*24*60*60*1000;
      const h = Math.floor(diff / (1000*60*60)); diff -= h*60*60*1000;
      const m = Math.floor(diff / (1000*60)); diff -= m*60*1000;
      const s = Math.floor(diff / 1000);
      document.getElementById('cd-days').textContent = d;
      document.getElementById('cd-hours').textContent = h;
      document.getElementById('cd-mins').textContent = m;
      document.getElementById('cd-secs').textContent = s;
    }
    function maybeShowSpecialBanner() {
      const c = document.getElementById('specialBannerContainer');
      const today = new Date();
      const mmdd = (today.getMonth()+1) + '-' + today.getDate();
      // Voorbeeld: 14-2 Valentijn
      if (mmdd === '2-14') {
        c.innerHTML = `<div class="special-date-banner">üíò Valentijnsdag-bonus: dubbel punten voor romance-challenges vandaag!</div>`;
      } else {
        c.innerHTML = '';
      }
    }

    /* ------------------------
       Hearts
       ------------------------ */
    function spawnHearts() {
      const container = document.getElementById('hearts');
      const emojis = ['üíñ','üíú','üíò','üíû','üíô'];
      for (let i=0;i<20;i++) {
        const span = document.createElement('span');
        span.className = 'heart';
        span.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        span.style.left = Math.random()*100 + '%';
        span.style.animationDelay = (Math.random()*8) + 's';
        span.style.fontSize = (14 + Math.random()*24) + 'px';
        container.appendChild(span);
      }
      setInterval(() => {
        const span = document.createElement('span');
        span.className = 'heart';
        span.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        span.style.left = Math.random()*100 + '%';
        span.style.animationDelay = '0s';
        span.style.fontSize = (14 + Math.random()*24) + 'px';
        container.appendChild(span);
        // cleanup
        setTimeout(() => { if (container.children.length > 80) container.removeChild(container.firstChild); }, 9000);
      }, 1200);
    }

    /* ------------------------
       Boot
       ------------------------ */
    function init() {
      spawnHearts();
      renderCountdown();
      maybeShowSpecialBanner();
      showTab('countries');
      // default filter button active
      const firstFilter = document.querySelector('.filter-btn');
      if (firstFilter) firstFilter.classList.add('active');
    }

    // Expose for inline handlers
    window.showTab = showTab;
    window.openModal = openModal;
    window.toggleCountry = toggleCountry;
    window.completeChallenge = completeChallenge;
    window.undoChallenge = undoChallenge;
    window.openMilestone = openMilestone;

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
